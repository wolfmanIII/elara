{% extends 'base.html.twig' %}

{% block title %}ELaRA — Embedding Linking and Retrieval Answering{% endblock %}

{% block pageContent %}
<div class="bg-base-200 text-base-content">

    <div class="space-y-8 p-5">

        {# HERO #}
        <section class="grid gap-8 xl:gap-10 lg:grid-cols-[minmax(0,1.4fr),minmax(0,1fr)] items-start">
            <div class="space-y-6 text-center lg:text-left">
                <div class="badge badge-primary badge-lg font-semibold mx-auto lg:mx-0">
                    Motore RAG interno · Symfony 7.4 · PostgreSQL + pgvector
                </div>

                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight">
                    <span class="block text-info mt-2">
                        Embedding Linking and Retrieval Answering
                    </span>
                </h1>

                <p class="text-base sm:text-lg opacity-80 max-w-2xl mx-auto lg:mx-0">
                    Un motore RAG che indicizza i tuoi documenti, li trasforma in embedding vettoriali
                    e ti permette di interrogarli in linguaggio naturale tramite 2 semplici
                    endpoint <code class="kbd kbd-base">POST /api/chat</code>
                    e in modalità streaming su <code class="kbd kbd-base">/api/chat/stream</code>
                </p>

                <div class="flex flex-wrap justify-center lg:justify-start gap-3 sm:gap-4">
                    <a href="{{ path('app_ai_console') }}"
                       class="btn btn-info btn-outline gap-2">
                        <span class="">
                            {{ include('icons/almeno.html.twig') }}
                        </span>
                        <span class="material-symbols-rounded text-base">Almeno</span>
                    </a>

                    <a href="{{ path('app_cli_operations') }}" class="btn btn-ghost">
                        Quickstart CLI
                    </a>

                    <a href="{{ path('app_pipeline_architecture') }}" class="btn btn-outline">
                        Pipeline RAG
                    </a>
                </div>
            </div>

            <div class="w-full">
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body space-y-4">
                        <h2 class="card-title">
                            Chiedi qualcosa alla documentazione
                        </h2>

                        <p class="text-base opacity-80">
                            ELaRA collega l’utente finale con i documenti indicizzati:
                            PDF, markdown, DOCX e ODT.
                        </p>

                        <div class="mockup-code text-sm overflow-x-auto">
                            <pre data-prefix="$"><code>curl -X POST https://127.0.0.1:8000/api/chat \</code></pre>
                            <pre data-prefix=" "><code>  -H "Authorization: Bearer {token_generato}" \</code></pre>
                            <pre data-prefix=" "><code>  -H "Content-Type: application/json" \</code></pre>
                            <pre data-prefix=" "><code>  -d '{"question":"Riassumi la pipeline di indicizzazione"}'</code></pre>
                        </div>

                        <p class="text-base opacity-70">
                            L’endpoint <code class="kbd kbd-base">/api/chat</code> usa
                            <span class="font-semibold">ChatbotService</span> per:
                            embedding della domanda → ricerca vettoriale pgvector →
                            costruzione contesto → chiamata al modello AI (Ollama / OpenAI / Gemini).
                        </p>

                    </div>
                </div>
            </div>
        </section>

        {# ROADMAP / STATO PROGETTO #}
        <section id="roadmap" class="space-y-4 lg:space-6 pb-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4">
                <h2 class="text-xl sm:text-2xl font-bold">Stato del progetto &amp; Roadmap</h2>
                <span class="badge badge-warning badge-outline self-start sm:self-auto">
                    Work in progress
                </span>
            </div>

            <div class="grid gap-6 md:grid-cols-2">
                <div class="card bg-base-100 border border-base-300">
                    <div class="card-body space-y-3">
                        <h3 class="card-title text-base">Già implementato</h3>
                        <ul class="list-disc list-inside text-sm opacity-80 space-y-1">
                            <li>Motore RAG completo (indicizzazione, embedding, retrieval, risposta).</li>
                            <li>CLI Symfony per indicizzare, elencare, ripulire e resettare schema/documents.</li>
                            <li>Supporto backend AI multipli (Ollama / OpenAI / Gemini) configurabili via profili.</li>
                            <li>Persistenza PostgreSQL + pgvector con indice HNSW e DQL cosine_similarity.</li>
                            <li>Dashboard profili RAG + wizard base cambio profilo con alert embedding.</li>
                            <li>Retrieval allineato ai profili (top_k / min_score letti dal preset attivo).</li>
                            <li>Chatbot console + API JSON/SSE con fallback test/offline e loader fonti dedicato.</li>
                            <li>Autenticazione utenti + API token con revoca e tracking utilizzi; CLI ruoli (user-role).</li>
                            <li>Documentazione completa disponibile in-app (modali markdown) e in README/docs.</li>
                        </ul>
                    </div>
                </div>

                <div class="card bg-base-100 border border-base-300">
                    <div class="card-body space-y-3">
                        <h3 class="card-title text-base">Prossimi step</h3>
                        <ul class="list-disc list-inside text-sm opacity-80 space-y-1">
                            <li>Rendere l'interfaccia grafica più gradevole e professionale</li>
                            <li>Migliorare la risposta interattiva del chatbot(UX)</li>
                            <li>Passare ad un sistema di API token più sicuro(JWT?)</li>
                            <li>Implementare un sistema di caching più efficace</li>
                            <li>Automatizzare il flusso cambio profilo con CTA (reset schema / reindex) e stato.</li>
                            <li>Scheduler re-index (Messenger) con notifiche e controlli incrementali.</li>
                            <li>Dashboard file upload + gestione/sincronizzazione knowledge base.</li>
                            <li>Audit delle chat: log modello/latency/top_k + filtri.</li>
                            <li>Test di regressione RAG e baseline comparativa.</li>
                            <li>Alert stato indice (webhook/email) quando chunk non cercabili superano soglie.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

    </div>
</div>


{{ component('markdown_modal', {
    id: 'modal-elara-definizione',
    title: 'ELaRA — Definizione',
    markdownFile: 'docs/elara_definizione.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-ollama',
    title: 'ELaRA — Guida Ollama Backend',
    markdownFile: 'docs/ollama_ubuntu_24_04_guida.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-analisi',
    title: 'ELaRA — Analisi Tecnica',
    markdownFile: 'docs/elara_analisi_tecnica.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-flusso-applicativo',
    title: 'ELaRA — Flusso Applicativo',
    markdownFile: 'docs/elara_flusso_applicativo.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-flusso-servizi',
    title: 'ELaRA — Flusso Servizi',
    markdownFile: 'docs/elara_flusso_servizi_dettagliato.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-chunking-embedding',
    title: 'ELaRA — Guida Chunking Embedding',
    markdownFile: 'docs/guida_rag_chunking_embedding.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-parametri-risposte',
    title: 'ELaRA — Parametri e Qualità delle Risposte',
    markdownFile: 'docs/elara_parametri_qualita_risposte.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-readme',
    title: 'ELaRA — README',
    markdownFile: 'README.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-prompt',
    title: 'ELaRA — Guida al Prompt',
    markdownFile: 'docs/elara_guida_utente_prompt.md'
}) }}

{{ component('markdown_modal', {
    id: 'modal-elara-api-guide',
    title: 'ELaRA — Guida API',
    markdownFile: 'docs/elara_api_guide_curl_completa.md'
}) }}

{% endblock %}
